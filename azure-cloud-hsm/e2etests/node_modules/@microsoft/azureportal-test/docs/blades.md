<!-- markdownlint-disable MD041 REASON: File assembled with GitDown -->

#### Blade navigation

To navigate to blades within `@microsoft/azureportal-test` can use one of several approaches

- via a deep link to the blade using the `portal.navigateToUriFragment` function e.g

  ```ts
  import * as testFx from '@microsoft/azureportal-test';
  ...
  {"gitdown": "include-section", "file": "../test/PartTests.ts", "section": "blades#deepLinkQSBlade"}
  ```

- via clicking on another ux component that opens the blade

  ```ts
  // New sample needed
  ```

- via `portal.open*` functions open common portal blades like create, browse and resource summary blades. See [Opening common portal blades](#scenarios-opening-common-portal-blades)

- via `portal.search` function to search for, and open browse and resource blades

  ```ts
  import * as testFx from '@microsoft/azureportal-test';
  ...
  const subscriptionsBlade = testFx.portal.blade({ title: testSupport.subscription });

  testFx.portal.portalContext.features.push({ name: "feature.resourcemenu", value: "true" });
  return testFx.portal.goHome().then(() => {
      return testFx.portal.search(testSupport.subscription);
  }).then((results) => {
      return testFx.portal.wait<SearchResult>(() => {
          const result = results[0];
          return result.title.getText().then((title) => {
              return title === testSupport.subscription ? result : null;
          });
      });
  }).then((result) => {
      return result.click();
  }).then(() => {
      return testFx.portal.wait(until.isPresent(subscriptionsBlade));
  });
  ```

#### Locating an open blade

There are several approaches that can be used for locating an already opened blade use `testfx.portal.blade`.

#### Common portal blades

##### Opening the extensions Create blade

See [Opening an extensions gallery package create blade](#scenarios-create-opening-an-extensions-gallery-package-create-blade)

##### Opening the Browse blade for your resource

To open/navigate to the Browse blade from resource type you can use `portal.openBrowseBlade`. The returned promise will resolve with the browse blade.

```ts
import * as testFx from '@microsoft/azureportal-test';
...
{"gitdown": "include-section", "file": "../test/BrowseResourceBladeTests.ts", "section": "browse#openBrowseBlade"}
...
```

##### Opening a Resource Summary blade

To open/navigate to the Resource Summary blade for a specific resource you can use `portal.openResourceBlade`. The returned promise will resolve with the Resource summary blade for the given resource.

There are also several API's available to make testing common functionality within browse such as context menu commands and column picking fucntionality for more details see [Browse Scenarios](#scenarios-browse).

##### Spec Picker Blade

The `SpecPickerBlade` can be used to select/change the current spec of a resource.

##### Properties Blade

Navigation to the `PropertiesBlade` is done via the resource summary blade.

##### QuickStart Blade

Using a deep link you can navigate directly into a `QuickStartBlade` for a resource with `Portal.navigateToUriFragment`.

```ts
import * as testFx from '@microsoft/azureportal-test';
...
{"gitdown": "include-section", "file": "../test/PartTests.ts", "section": "blades#deepLinkQSBlade"}
```

While deeplinking is fast it does not validate that the user can actually navigate to a QuickStartBlade via a `ResourceSummaryPart` on a resource summary blade. The following demonstrates how to verify the user can do so.

```ts
import * as testFx from '@microsoft/azureportal-test';
...
//1. model your resource summary blade which contains a resource summary part
{"gitdown": "include-section", "file": "../test/Blades/SummaryBlade.ts", "section": "blades#summaryBlade"}
...
//2. navigate to the quickstart and click a link
const expectedEndTitle = resourceGroupName + " - " + "Quickstart";

const resourceBlade = await testFx.portal.openResourceBlade(resourceGroupId, resourceGroupName, testFx.PortalConfigurationManager.default.portalContext.timeouts.longTimeout);
//click to open the quickstart blade
await resourceBlade.openMenuItem(PortalFxResx.quickStartMenu);
await testFx.portal.wait(() => {
    return testFx.portal.blade({ title: expectedEndTitle });
}, null, "Title of the blade should update to include the Quickstart suffix");
...
```

##### Users Blade

Using a deep link you can navigate directly into the user access blade for a resource with `Portal.navigateToUriFragment`.

```ts
import * as testFx from '@microsoft/azureportal-test';
...
const resourceName = resourcePrefix + guid.newGuid();
const createOptions = {
    name: resourceName,
    resourceGroup: resourceGroupName,
    location: locationId,
    resourceProvider: resourceProvider,
    resourceType: resourceType,
    resourceProviderApiVersion: resourceProviderApiVersion,
    properties: {
        displacement: "600cc",
        model: "type2",
        status: 0,
    },
};

const resourceId = await testSupport.armClient.createResource(createOptions);
//form deep link to the quickstart blade
await testFx.portal.navigateToUriFragment(`blade/Microsoft_Azure_AD/UserAssignmentsBlade/scope/${resourceId}`, testFx.PortalConfigurationManager.default.portalContext.timeouts.longTimeout);
return await testFx.portal.wait(ExpectedConditions.isPresent(testFx.portal.element(testFx.Blades.UsersBlade)));
```

While deeplinking is fast it does not validate that the user can actually navigate to a UsersBlade via a `ResourceSummaryPart` on a resource summary blade. The following demonstrates how to verify the user can do so.

```ts
import * as testFx from '@microsoft/azureportal-test';
...
//1. model your resource summary blade which contains a resource summary part
{"gitdown": "include-section", "file": "../test/Blades/SummaryBlade.ts", "section": "blades#summaryBlade"}
...
//2. navigate to the quickstart and click a link
const expectedEndTitle = resourceGroupName + " - " + PortalFxResx.usersMenu;

const resourceBlade = await testFx.portal.openResourceBlade(resourceGroupId, resourceGroupName, testFx.PortalConfigurationManager.default.portalContext.timeouts.longTimeout);
//click to open the user access blade
await resourceBlade.openMenuItem(PortalFxResx.usersMenu);
await testFx.portal.wait(() => {
    return testFx.portal.blade({ title: expectedEndTitle });
}, null, "Title of the blade should update to include the Users suffix");
...
```

#### Blade Dialogs

On some blades you may use commands that cause a blade dialog that generally required the user to perform some acknowledgement action.
The `Blade` class exposes a `dialog` function that can be used to locate the dialog on the given blade and perform an action against it.
The following example demonstrates how to:

- get a reference to a dialog by title
- find a field within the dialog and sendKeys to it
- clicking on a button in a dialog

```ts
import * as testFx from '@microsoft/azureportal-test';
...
{"gitdown": "include-section", "file": "../test/GenericBladeTests.ts", "section": "blades#dialog"}
```

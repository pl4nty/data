"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testFx = require("../src/Index");
const TestSupport_1 = require("./TestSupport");
var EditableGrid = testFx.Controls.EditableGrid;
var assert = testFx.Utils.Assert;
describe("EditableGrid Tests", function () {
    this.timeout(0);
    const testSupport = new TestSupport_1.default(this);
    const resourceGroups = new Array();
    before(() => {
        testSupport.initializePortalContext();
        return testSupport.initializeArmClient();
    });
    it("Get validation errors", async () => {
        await testFx.portal.navigateToUriFragment("blade/SamplesExtension/EditableGrid/Validation", 70000);
        const gridBlade = testFx.portal.blade({ title: "EditableGrid | Validation" });
        await gridBlade.waitUntilBladeAndAllTilesLoaded();
        const grid = gridBlade.element(EditableGrid);
        await testFx.portal.wait(async () => {
            const count = await grid.rows.count();
            return count > 0;
        });
        await grid.rows.first().click();
        await grid.rows.first().cells.first().setInputValue("a");
        const errors = await testFx.portal.wait(async () => {
            return await grid.rows.first().validationErrors();
        });
        await assert.ok(errors.includes("Account number is required"), "Account validation error present");
    });
    afterEach(async function () {
        const currentTest = this.currentTest;
        testSupport.LogRetry(currentTest);
        if (currentTest.state === "failed") {
            await testSupport.GatherTestFailureDetails(currentTest, __filename);
        }
    });
    after(() => {
        const promises = resourceGroups.map((resourceGroup) => testSupport.armClient.deleteResourceGroup(resourceGroup).catch((error) => {
            const log = (error.reason || "").includes("NotFound") ? console.info : console.error;
            log(`Failed to delete resource group "${resourceGroup}" with error: ${JSON.stringify(error)}`);
        }));
        return testFx.portal.quit().finally(() => {
            return Promise.allSettled(promises);
        });
    });
});
//# sourceMappingURL=EditableGridTests.js.map
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testFx = require("../src/Index");
const TestSupport_1 = require("./TestSupport");
describe("CBA Test", function () {
    let originalPortalUrl = null;
    let originalTenantId = null;
    this.timeout(0);
    const testSupport = new TestSupport_1.default(this);
    before(() => {
        console.log("Reset and Save Portal context before running CBA test");
        // TODO: This CBA test currently runs on a different prod tenant. In the future, should either migrate to different suite or configure
        // test to run in a congfigured tenant. Current workaround is to set new tenant for test, and restore after.
        testSupport.initializePortalContext();
        originalPortalUrl = testFx.portal.portalContext.portalUrl;
        originalTenantId = testFx.portal.portalContext.tenantId;
    });
    it("Can Login With Certificate Authentication", async () => {
        console.log("Attempt CBA Login");
        testFx.portal.portalContext.certBasedAuth = true;
        testFx.portal.portalContext.portalUrl =
            testFx.PortalConfigurationManager.default.get("CBATestSettings").portalUrl;
        testFx.portal.portalContext.tenantId =
            testFx.PortalConfigurationManager.default.get("CBATestSettings").tenantId;
        testFx.portal.portalContext.signInEmail =
            testFx.PortalConfigurationManager.default.get("CBATestSettings").USER_EMAIL_CBA;
        try {
            await testFx.portal.goHome();
        }
        catch (e) {
            const errorMessage = e?.message ?? "";
            console.log("CBA Login failed with error:");
            console.log(errorMessage);
            throw e;
        }
    });
    after(() => {
        // TODO: This CBA test currently runs on a different prod tenant. In the future, should either migrate to different suite or configure
        // test to run in a congfigured tenant. Current workaround is to set new tenant for test, and restore after.
        console.log("Restoring original portal context");
        testFx.portal.portalContext.portalUrl = originalPortalUrl;
        testFx.portal.portalContext.tenantId = originalTenantId;
    });
});
//# sourceMappingURL=CertBasedAuthTest.js.map
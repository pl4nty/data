-- Decompiled using luadec 2.2 rev: 895d923 for Lua 5.1 from https://github.com/viruscamp/luadec
-- Command line: lua\!InfrastructureShared\!#ALFExploitWin32Rupadob!dha\1.luac 

-- params : ...
-- function num : 0
local l_0_0 = function(l_1_0, l_1_1)
  -- function num : 0_0
  local l_1_2 = (mp.readu_u16)(l_1_0, l_1_1 + 2)
  local l_1_3 = (mp.readu_u32)(l_1_0, l_1_1 + 2 + 2)
  local l_1_4 = (mp.readu_u32)(l_1_0, l_1_1 + 2 + 2 + 4)
  local l_1_5 = (mp.readu_u32)(l_1_0, l_1_1 + 2 + 2 + 4 + 4 + 4)
  return l_1_2, l_1_3, l_1_4, l_1_5
end

local l_0_1 = function(l_2_0, l_2_1, l_2_2, l_2_3)
  -- function num : 0_1
  local l_2_4 = 0
  local l_2_5 = 0
  local l_2_6 = false
  local l_2_7 = false
  if (mp.bitand)(l_2_0, 16384) then
    l_2_4 = l_2_1 * 8 + 20
    l_2_5 = l_2_1 * 8 + 8
    if l_2_4 ~= l_2_2 then
      l_2_6 = true
    end
    if l_2_5 ~= l_2_3 then
      l_2_7 = true
    end
  else
    l_2_4 = l_2_1 * 16 + 20
    l_2_5 = l_2_1 * 16 + 8
    if l_2_4 ~= l_2_2 then
      l_2_6 = true
    end
    if l_2_5 ~= l_2_3 then
      l_2_7 = true
    end
  end
  return l_2_6, l_2_7
end

local l_0_2 = (mp.getfilesize)()
if l_0_2 > 1280 or l_0_2 < 128 then
  return mp.CLEAN
end
;
(mp.readprotection)(false)
local l_0_3 = (mp.readfile)(0, l_0_2 - 16)
;
(mp.readprotection)(true)
local l_0_4 = (string.find)(l_0_3, "EMF+", 1, true)
if l_0_4 == nil then
  return mp.CLEAN
end
l_0_3 = (string.sub)(l_0_3, l_0_4, #l_0_3 - l_0_4 - 1)
local l_0_5 = 1
local l_0_6, l_0_7, l_0_8, l_0_9, l_0_10, l_0_11 = nil, nil, nil, nil, nil, nil
do
  while l_0_5 <= #l_0_3 do
    local l_0_12 = (string.find)(l_0_3, "\n@", l_0_5, true)
    if l_0_12 == nil then
      return mp.CLEAN
    end
    l_0_6 = l_0_0(l_0_3, l_0_12)
    if l_0_7 ~= l_0_8 + 12 or #l_0_3 - l_0_12 <= l_0_7 or #l_0_3 - l_0_12 <= l_0_8 then
      return mp.CLEAN
    end
    l_0_10 = l_0_1(l_0_6, l_0_9, l_0_7, l_0_8)
    if l_0_10 or l_0_11 then
      return mp.INFECTED
    end
    l_0_5 = l_0_5 + l_0_12 + 2
  end
  return mp.CLEAN
end

